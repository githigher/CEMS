<template>
  <div>
    <v-form-render :form-json="formJson" :form-data="formData" :option-data="optionData" ref="vFormRef">
    </v-form-render>
    <el-button type="primary" @click="submitForm">Submit</el-button>
  </div>
</template>

<script setup>
  import { ref, reactive } from 'vue'
  import { ElMessage } from 'element-plus'
  import Cookies from 'js-cookie'

  const formJson = reactive({"widgetList":[{"key":103026,"type":"picture-upload","icon":"picture-upload-field","formItemFlag":true,"options":{"name":"picture","label":"证明材料","labelAlign":"label-left-align","labelWidth":null,"labelHidden":false,"columnWidth":"200px","disabled":false,"hidden":false,"required":true,"requiredHint":"","customRule":"","customRuleHint":"","uploadURL":"http://127.0.0.1:8000/imgs/upload","uploadTip":"上传文件类型仅支持JPG、JPEG和PNG，文件大小限制1MB","withCredentials":false,"multipleSelect":false,"showFileList":true,"limit":1,"fileMaxSize":1,"fileTypes":["jpg","jpeg","png"],"customClass":[],"labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"onCreated":"","onMounted":"","onBeforeUpload":"","onUploadSuccess":"","onUploadError":"","onFileRemove":"","onValidate":""},"id":"pictureupload87167"},{"key":101886,"type":"cascader","icon":"cascader-field","formItemFlag":true,"options":{"name":"type","label":"加分类别","labelAlign":"","defaultValue":"","placeholder":"","size":"","labelWidth":null,"labelHidden":false,"columnWidth":"200px","disabled":false,"hidden":false,"clearable":true,"filterable":false,"multiple":false,"checkStrictly":false,"showAllLevels":true,"optionItems":[{"label":"德育","value":1,"children":[{"label":"思想政治与道德素养","value":"思想政治与道德素养"},{"label":"学科竞赛与技能培训","value":"学科竞赛与技能培训"},{"label":"社会实践与志愿服务","value":"社会实践与志愿服务"},{"label":"文化活动","value":"文化活动"},{"label":"学生干部任职","value":"学生干部任职"}]},{"label":"体育","value":2,"children":[{"label":"体育比赛","value":"体育比赛"},{"label":"军训阅兵","value":"军训阅兵"},{"label":"参加学校田径运动会开幕式、团体啦啦操和百里毅行","value":"参加学校田径运动会开幕式、团体啦啦操和百里毅行"},{"label":"裁判证","value":"裁判证"}]},{"label":"劳育","value":3,"children":[{"label":"文明寝室创建工作中获荣誉称号","value":"文明寝室创建工作中获荣誉称号"},{"label":"寝室日常检查中获优秀寝室","value":"寝室日常检查中获优秀寝室"},{"label":"参与学院公共卫生区域打扫","value":"参与学院公共卫生区域打扫"}]}],"required":true,"requiredHint":"","customRule":"","customRuleHint":"","customClass":[],"labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"onCreated":"","onMounted":"","onChange":"","onFocus":"","onBlur":"","onValidate":""},"id":"cascader45264"},{"key":76893,"type":"input","icon":"text-field","formItemFlag":true,"options":{"name":"summary","label":"奖项名称","labelAlign":"","type":"text","defaultValue":"","placeholder":"","columnWidth":"200px","size":"","labelWidth":null,"labelHidden":false,"readonly":false,"disabled":false,"hidden":false,"clearable":true,"showPassword":false,"required":true,"requiredHint":"","validation":"","validationHint":"","customClass":[],"labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"minLength":null,"maxLength":null,"showWordLimit":false,"prefixIcon":"","suffixIcon":"","appendButton":false,"appendButtonDisabled":false,"buttonIcon":"custom-search","onCreated":"","onMounted":"","onInput":"","onChange":"","onFocus":"","onBlur":"","onValidate":"","onAppendButtonClick":""},"id":"input96641"},{"key":79290,"type":"input","icon":"text-field","formItemFlag":true,"options":{"name":"unit","label":"颁发单位","labelAlign":"","type":"text","defaultValue":"","placeholder":"","columnWidth":"200px","size":"","labelWidth":null,"labelHidden":false,"readonly":false,"disabled":false,"hidden":false,"clearable":true,"showPassword":false,"required":true,"requiredHint":"","validation":"","validationHint":"","customClass":"","labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"minLength":null,"maxLength":null,"showWordLimit":false,"prefixIcon":"","suffixIcon":"","appendButton":false,"appendButtonDisabled":false,"buttonIcon":"custom-search","onCreated":"","onMounted":"","onInput":"","onChange":"","onFocus":"","onBlur":"","onValidate":"","onAppendButtonClick":""},"id":"input46215"},{"key":76020,"type":"cascader","icon":"cascader-field","formItemFlag":true,"options":{"name":"grade","label":"获奖等级","labelAlign":"","defaultValue":"","placeholder":"","size":"","labelWidth":null,"labelHidden":false,"columnWidth":"200px","disabled":false,"hidden":false,"clearable":true,"filterable":false,"multiple":false,"checkStrictly":false,"showAllLevels":true,"optionItems":[{"label":"国家级","value":1,"children":[{"label":"国家级一等奖","value":"国家级一等奖"},{"label":"国家级二等奖","value":"国家级二等奖"},{"label":"国家级三等奖","value":"国家级三等奖"},{"label":"国家级优胜奖","value":"国家级优胜奖"}]},{"label":"省级","value":2,"children":[{"label":"省级一等奖","value":"省级一等奖"},{"label":"省级二等奖","value":"省级二等奖"},{"label":"省级三等奖","value":"省级三等奖"},{"label":"省级优胜奖","value":"省级优胜奖"}]},{"label":"校级","value":3,"children":[{"label":"校级一等奖","value":"校级一等奖"},{"label":"校级二等奖","value":"校级二等奖"},{"label":"校级三等奖","value":"校级三等奖"},{"label":"校级优胜奖","value":"校级优胜奖"}]},{"label":"院级","value":4,"children":[{"label":"院级一等奖","value":"院级一等奖"},{"label":"院级二等奖","value":"院级二等奖"},{"label":"院级三等奖","value":"院级三等奖"},{"label":"院级优胜奖","value":"院级优胜奖"}]},{"label":"其他","value":5,"children":[{"label":"市级","value":"市级"},{"label":"社会单位","value":"社会单位"},{"label":"其他","value":"其他"}]}],"required":true,"requiredHint":"","customRule":"","customRuleHint":"","customClass":"","labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"onCreated":"","onMounted":"","onChange":"","onFocus":"","onBlur":"","onValidate":""},"id":"cascader41156"},{"key":14337,"type":"cascader","icon":"cascader-field","formItemFlag":true,"options":{"name":"people","label":"奖项类型","labelAlign":"","defaultValue":"","placeholder":"","size":"","labelWidth":null,"labelHidden":false,"columnWidth":"200px","disabled":false,"hidden":false,"clearable":true,"filterable":false,"multiple":false,"checkStrictly":false,"showAllLevels":true,"optionItems":[{"label":"个人赛","value":1,"children":[{"label":"排名第一","value":"排名第一"}]},{"label":"团体赛","value":2,"children":[{"label":"排名第一","value":"排名第一"},{"label":"排名第二","value":"排名第二"},{"label":"排名第三","value":"排名第三"},{"label":"排名第四","value":"排名第四"},{"label":"排名第五","value":"排名第五"},{"label":"其他","value":"其他"}]}],"required":true,"requiredHint":"","customRule":"","customRuleHint":"","customClass":"","labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"onCreated":"","onMounted":"","onChange":"","onFocus":"","onBlur":"","onValidate":""},"id":"cascader95332"},{"key":28542,"type":"input","icon":"text-field","formItemFlag":true,"options":{"name":"score","label":"申请分数","labelAlign":"","type":"text","defaultValue":"","placeholder":"","columnWidth":"200px","size":"","labelWidth":null,"labelHidden":false,"readonly":false,"disabled":false,"hidden":false,"clearable":true,"showPassword":false,"required":true,"requiredHint":"","validation":"number","validationHint":"","customClass":"","labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"minLength":null,"maxLength":null,"showWordLimit":false,"prefixIcon":"","suffixIcon":"","appendButton":false,"appendButtonDisabled":false,"buttonIcon":"custom-search","onCreated":"","onMounted":"","onInput":"","onChange":"","onFocus":"","onBlur":"","onValidate":"","onAppendButtonClick":""},"id":"input98144"},{"key":21629,"type":"alert","icon":"alert","formItemFlag":false,"options":{"name":"alert46837","title":"申请分数一栏请大家对照文件自行计算，经过审核后，可能与所填分数有所出入","type":"info","description":"","closable":true,"closeText":"","center":true,"showIcon":false,"effect":"light","hidden":false,"onClose":"","customClass":[],"label":"alert"},"id":"alert46837"},{"key":81717,"type":"divider","icon":"divider","formItemFlag":false,"options":{"name":"divider102778","label":"","columnWidth":"200px","direction":"horizontal","contentPosition":"center","hidden":false,"customClass":[],"onCreated":"","onMounted":""},"id":"divider102778"}],"formConfig":{"modelName":"formData","refName":"vForm","rulesName":"rules","labelWidth":80,"labelPosition":"left","size":"","labelAlign":"label-left-align","cssCode":"","customClass":[],"functions":"","layoutType":"PC","jsonVersion":3,"onFormCreated":"","onFormMounted":"","onFormDataChange":""}})
  const formData = reactive({})
  const optionData = reactive({})
  const vFormRef = ref(null)

  const submitForm = () => {
    vFormRef.value.getFormData().then(formData => {
      // Form Validation OK
      axios.post('http://127.0.0.1:8000/submit', {id: Cookies.get("UserId"), picture: formData.picture[0].response.data.url, type: formData.type[1], summary: formData.summary, score: formData.score, unit: formData.unit, grade: formData.grade[1], people: formData.people[1]})
      .then(response =>{
        if (response.data.code == "001"){
          alert("提交成功")
        }else{
          alert("提交失败")
        }
        location.reload()  
      })
      .catch(error =>{
        alert("Something went wrong...")
      })
    }).catch(error => {
      // Form Validation failed
      ElMessage.error(error)
    })
  }
</script>